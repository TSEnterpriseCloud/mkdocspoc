
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.5.42" name="generator"/>
<title>Policy preview - TeamSystem Enterprise Cloud</title>
<link href="../../assets/stylesheets/main.0253249f.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<link href="/static/css/custom.css" rel="stylesheet"/>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="indigo" data-md-color-primary="indigo" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#policy-preview">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="TeamSystem Enterprise Cloud" class="md-header__button md-logo" data-md-component="logo" href="../.." title="TeamSystem Enterprise Cloud">
<img alt="logo" src="../../static/img/LOGO_SCRITTA_ENTERPRISE CLOUD_colori.png"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            TeamSystem Enterprise Cloud
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Policy preview
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="" data-md-color-primary="indigo" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="" data-md-color-primary="indigo" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<div class="md-header__option">
<div class="md-select">
<button aria-label="Select language" class="md-header__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"></path></svg>
</button>
<div class="md-select__inner">
<ul class="md-select__list">
<li class="md-select__item">
<a class="md-select__link" href="/en/" hreflang="en">
              English
            </a>
</li>
<li class="md-select__item">
<a class="md-select__link" href="/de/" hreflang="de">
              Deutsch
            </a>
</li>
<li class="md-select__item">
<a class="md-select__link" href="/es/" hreflang="es">
              Spanish
            </a>
</li>
</ul>
</div>
</div>
</div>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../started/getting-started/">
          
  
  Getting Started

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../stepbystep/common-terms/">
          
  
  Step by step guide

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../stepbystep/quickstarts/postman-collection/">
          
  
  Quickstarts

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../scenario/anagrafiche/">
          
  
  Supported scenarios

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../basics/scopes/">
          
  
  Basics

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../reference/api-reference-co/">
          
  
  Api Reference

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../sdks/typescript-sdk/">
          
  
  SDKs

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../support/faq/">
          
  
  Support &amp; Feature Request

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../legal/terms/">
          
  
  Legal

        </a>
</li>
</ul>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="TeamSystem Enterprise Cloud" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="TeamSystem Enterprise Cloud">
<img alt="logo" src="../../static/img/LOGO_SCRITTA_ENTERPRISE CLOUD_colori.png"/>
</a>
    TeamSystem Enterprise Cloud
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
<span class="md-ellipsis">
    Getting Started
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_1_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_1">
<span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../started/getting-started/">
<span class="md-ellipsis">
    Introduction
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../started/authentication/">
<span class="md-ellipsis">
    Authentication
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../started/howto/">
<span class="md-ellipsis">
    How to
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
<span class="md-ellipsis">
    Step by step guide
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            Step by step guide
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../stepbystep/common-terms/">
<span class="md-ellipsis">
    Common Terms
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../stepbystep/company-scoped-methods/">
<span class="md-ellipsis">
    Company methods
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../stepbystep/manual-authentication/">
<span class="md-ellipsis">
    Authentication mode
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
<span class="md-ellipsis">
    Quickstarts
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            Quickstarts
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../stepbystep/quickstarts/postman-collection/">
<span class="md-ellipsis">
    Postaman Collections
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../stepbystep/quickstarts/csharp-sdk-quickstart/">
<span class="md-ellipsis">
    C# SDK Quickstart
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../stepbystep/quickstarts/go-sdk-quickstart/">
<span class="md-ellipsis">
    GO SDK Quickstart
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../stepbystep/quickstarts/java-sdk-quickstart/">
<span class="md-ellipsis">
    Java SDK Quickstart
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../stepbystep/quickstarts/js-sdk-quickstart/">
<span class="md-ellipsis">
    JavaScript SDK Quickstart
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../stepbystep/quickstarts/php-sdk-quickstart/">
<span class="md-ellipsis">
    PHP SDK Quickstart
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../stepbystep/quickstarts/python-sdk-quickstart/">
<span class="md-ellipsis">
    Python SDK Quickstart
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../stepbystep/quickstarts/ruby-sdk-quickstart/">
<span class="md-ellipsis">
    Ruby SDK Quickstart
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../stepbystep/quickstarts/ts-sdk-quickstart/">
<span class="md-ellipsis">
    TypeScript SDK Quickstart
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../stepbystep/quickstarts/vanilla-code/">
<span class="md-ellipsis">
    Vanilla Code Sample
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../stepbystep/quickstarts/windows-form-quickstart/">
<span class="md-ellipsis">
    Windows Form Quickstart
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../stepbystep/quickstarts/google-sheets-quickstart/">
<span class="md-ellipsis">
    Google Sheets Apps Script Quickstart
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../stepbystep/quickstarts/zapier-quickstart/">
<span class="md-ellipsis">
    Zapier Quickstart
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
<span class="md-ellipsis">
    Supported scenarios
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            Supported scenarios
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../scenario/anagrafiche/">
<span class="md-ellipsis">
    Anagrafiche
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../scenario/invoice-creation/">
<span class="md-ellipsis">
    Invoice creation
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../scenario/e-invoice-xml-customisation/">
<span class="md-ellipsis">
    E-Invoice XML Customisation
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
<span class="md-ellipsis">
    Basics
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            Basics
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../basics/scopes/">
<span class="md-ellipsis">
    Scopes
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../basics/errors/">
<span class="md-ellipsis">
    Errors
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../basics/limits-and-quotas/">
<span class="md-ellipsis">
    Limits adn Quotas
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
<span class="md-ellipsis">
    Additional capabilities
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_4_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_4">
<span class="md-nav__icon md-icon"></span>
            Additional capabilities
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../basics/additional-capabilities/sort-results/">
<span class="md-ellipsis">
    Sort Results
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../basics/additional-capabilities/paginate-results/">
<span class="md-ellipsis">
    Paginate results
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../basics/additional-capabilities/customize-response/">
<span class="md-ellipsis">
    Customize response
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../basics/additional-capabilities/filter-results/">
<span class="md-ellipsis">
    Filter results
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../basics/debug-your-integration/">
<span class="md-ellipsis">
    Debug your integration
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
<span class="md-ellipsis">
    Api Reference
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_6_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
            Api Reference
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../reference/api-reference-co/">
<span class="md-ellipsis">
    Common api
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../reference/api-reference-fi/">
<span class="md-ellipsis">
    Finance api
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../reference/api-reference-mg/">
<span class="md-ellipsis">
    Warehouse api
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../reference/api-reference/">
<span class="md-ellipsis">
    Use the API Reference
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_7" type="checkbox"/>
<label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
<span class="md-ellipsis">
    SDKs
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_7_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_7">
<span class="md-nav__icon md-icon"></span>
            SDKs
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../sdks/typescript-sdk/">
<span class="md-ellipsis">
    TypeScript SDK
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sdks/java-sdk/">
<span class="md-ellipsis">
    Java SDK
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sdks/javascript-sdk/">
<span class="md-ellipsis">
    JavaScript SDK
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sdks/net-sdk/">
<span class="md-ellipsis">
    .NET SDK
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sdks/python-sdk/">
<span class="md-ellipsis">
    Python SDK
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sdks/ruby-sdk/">
<span class="md-ellipsis">
    Ruby SDK
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_8" type="checkbox"/>
<label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
<span class="md-ellipsis">
    Support &amp; Feature Request
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_8_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_8">
<span class="md-nav__icon md-icon"></span>
            Support &amp; Feature Request
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../support/faq/">
<span class="md-ellipsis">
    FAQs
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../support/general-knowledge/oauth2/index.md">
<span class="md-ellipsis">
    General Knowledge
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_9" type="checkbox"/>
<label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
<span class="md-ellipsis">
    Legal
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_9_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_9">
<span class="md-nav__icon md-icon"></span>
            Legal
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../legal/terms/">
<span class="md-ellipsis">
    Condizioni generali di utilizzo delle API MadBit
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../legal/policy-acceptable-use/">
<span class="md-ellipsis">
    Policy di Acceptable Use
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../legal/marketing-resources-and-identity-guidelines/">
<span class="md-ellipsis">
    Marketing Resources and Identity Guidelines
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#guidance">
<span class="md-ellipsis">
      Guidance
    </span>
</a>
<nav aria-label="Guidance" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#non-goals">
<span class="md-ellipsis">
      Non-goals
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#experiments">
<span class="md-ellipsis">
      Experiments
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#metadata">
<span class="md-ellipsis">
      Metadata
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#methods">
<span class="md-ellipsis">
      Methods
    </span>
</a>
<nav aria-label="Methods" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#create">
<span class="md-ellipsis">
      create
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#update">
<span class="md-ellipsis">
      update
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#get">
<span class="md-ellipsis">
      get
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#list">
<span class="md-ellipsis">
      list
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#delete">
<span class="md-ellipsis">
      delete
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#startpreview">
<span class="md-ellipsis">
      startPreview
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#stoppreview">
<span class="md-ellipsis">
      stopPreview
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#commit">
<span class="md-ellipsis">
      commit
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#changes-to-live-policy-api-methods">
<span class="md-ellipsis">
      Changes to live policy API methods
    </span>
</a>
<nav aria-label="Changes to live policy API methods" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#delete_1">
<span class="md-ellipsis">
      delete
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#logging">
<span class="md-ellipsis">
      Logging
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#changelog">
<span class="md-ellipsis">
      Changelog
    </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="policy-preview">Policy preview</h1>
<p>A policy is a resource that provides rules that admit or deny access to other
resources. Generally, the outcome of a policy can be evaluated to a specific set
of outcomes.</p>
<p>Changes to policies without proper validation may have unintended consequences
that can severely impact a customer’s overall infrastructure setup. To safely
update resources, it is beneficial to test these changes via policy rollout
APIs.</p>
<p>Preview is a rollout safety mechanism for policy resources, which gives the
customer the ability to validate the effect of their proposed changes against
production traffic prior to the changes going live. The result of the policy
evaluation against traffic is logged in order to give the customer the data
required to test the correctness of the change.</p>
<p>Firewall policies exemplify a case that is suitable for previewing. A new
configuration can be evaluated against traffic to observe which IPs would be
allowed or denied. This gives the customer the data to guide a decision on
whether to promote the proposed changes to live.</p>
<p>The expected flow for previewing a policy is as follows:</p>
<ol>
<li>The user creates an experiment containing a new policy configuration
   intended to replace the live policy.</li>
<li>The user uses the "startPreview" method to start generating logs which compare
   the live and experiment policy evaluations against live traffic.</li>
<li>The user inspects the logs to determine whether the experiment has the
   intended result.</li>
<li>The user uses the "commit" method to promote the experiment to live.</li>
</ol>
<h2 id="guidance">Guidance</h2>
<h3 id="non-goals">Non-goals</h3>
<p>This proposal is for a safety mechanism for policy rollouts only. Safe rollouts
for non-policy resources are not in scope.</p>
<h3 id="experiments">Experiments</h3>
<p>A new configuration of a policy to be previewed is stored as a nested collection
under the policy. These nested collections are known as experiments.</p>
<p>A hypothetical policy resource called, <code>Policy</code>, is used throughout. It has the
following resource name pattern:</p>
<p><code>projects/{project}/locations/{location}/policies/{policy}</code></p>
<p>The experimental versions of the resource used for previewing or other safe
rollout practices are represented as a nested collection under <code>Policy</code> using a
new resource type. The resource type <strong>must</strong> follow the naming convention
<em>RegularResourceType</em><code>Experiment</code>.</p>
<p>The following pattern is used for the experiment collection:</p>
<p><code>projects/{project}/locations/{location}/policies/{policy}/experiments/{experiment}</code></p>
<p>A proto used to represent an experiment <strong>must</strong> contain the following:</p>
<ol>
<li>The required top-level fields for a resource, like <code>name</code> and <code>etag</code></li>
<li>The policy message that is being tested itself</li>
<li>The field, <code>preview_metadata</code>, which contains metadata specific to
     previewing the experiment of a specific resource type.</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="kd">message</span><span class="w"> </span><span class="nc">PolicyExperiment</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="c1">// google.api.resource, name, and other annotations and fields</span>

<span class="w">  </span><span class="c1">// The policy experiment. This Policy will be used to preview the effects of</span>
<span class="w">  </span><span class="c1">// the change but will not affect live traffic.</span>
<span class="w">  </span><span class="n">Policy</span><span class="w"> </span><span class="na">policy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>

<span class="w">  </span><span class="c1">// The metadata associated with this policy experiment.</span>
<span class="w">  </span><span class="n">PolicyPreviewMetadata</span><span class="w"> </span><span class="na">preview_metadata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span>
<span class="w">      </span><span class="p">[(</span><span class="n">google.api.field_behavior</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OUTPUT_ONLY</span><span class="p">];</span>

<span class="w">  </span><span class="c1">// Allows clients to store small amounts of arbitrary data.</span>
<span class="w">  </span><span class="n">map</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="p">&gt;</span><span class="w"> </span><span class="na">annotations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>The experiment proto <strong>must</strong> have a top-level field with the same type as the
  live policy.</li>
<li>It <strong>must</strong> be named as the live resource type. For example, if the
    experiment is for FirewallPolicy, then this field <strong>must</strong> be named
    <code>firewall_policy</code>.</li>
<li>The name inside the embedded <code>policy</code> message <strong>must</strong> be the name of the
    live policy.</li>
<li>When the user is ready to promote an experiment, they <strong>must</strong> copy the
  <code>policy</code> message into the live policy and delete the experiment. This can be
  done manually or via a "commit" custom method.</li>
<li>A product <strong>may</strong> support multiple experiments concurrently being previewed
  for a single live policy.</li>
<li>Each experiment must generate logs having each entry preceded by log_prefix
    so that the user can compare the results of the experiment with the behavior
    of the live policy.</li>
<li>The number of experimental configurations for a given live policy <strong>may</strong> be
    capped at a certain number and the cap <strong>must</strong> be documented.</li>
<li>Cascading deletes <strong>must</strong> occur: if the live policy is deleted, all
  experiments <strong>must</strong> also be deleted.</li>
<li><code>map&lt;string,string&gt;</code> <a href="https://aip.dev/128#annotations">annotations</a> <strong>must</strong> allow clients
  to store small amounts of arbitrary data.</li>
</ul>
<h3 id="metadata">Metadata</h3>
<p><code>preview_metadata</code> tracks all metadata of previewing the experiment. The
messages <strong>must</strong> follow the convention: <em>RegularResourceType</em><code>PreviewMetadata</code>.
This is so the proto can be defined uniquely for each resource type in the
same service with experiments.</p>
<div class="highlight"><pre><span></span><code><span class="kd">message</span><span class="w"> </span><span class="nc">PolicyPreviewMetadata</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Possible values of the state of previewing the experiment.</span>
<span class="w">  </span><span class="kd">enum</span><span class="w"> </span><span class="n">State</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Default value. This value is unused.</span>
<span class="w">    </span><span class="na">STATE_UNDEFINED</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// The experiment is actively previewing.</span>
<span class="w">    </span><span class="na">ACTIVE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// The previewing of the experiment has been stopped.</span>
<span class="w">    </span><span class="na">SUSPENDED</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// The state of previewing the experiment.</span>
<span class="w">  </span><span class="n">State</span><span class="w"> </span><span class="na">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>

<span class="w">  </span><span class="c1">// An identifying string common to all logs generated when previewing the</span>
<span class="w">  </span><span class="c1">// experiment. Searching all logs for this string will isolate the results.</span>
<span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="na">log_prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>

<span class="w">  </span><span class="c1">// The most recent time at which this experiment started previewing.</span>
<span class="w">  </span><span class="n">google.protobuf.Timestamp</span><span class="w"> </span><span class="na">start_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>

<span class="w">  </span><span class="c1">// The most recent time at which this experiment stopped previewing.</span>
<span class="w">  </span><span class="n">google.protobuf.Timestamp</span><span class="w"> </span><span class="na">stop_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li><code>PolicyPreviewMetadata</code> <strong>must</strong> have the fields defined in the proto above.</li>
<li>It <strong>may</strong> have additional fields if the service or resource requires it.</li>
<li>When an experiment is first previewed, <code>preview_metadata</code> <strong>must</strong> be
  absent.</li>
<li>It is present on the experiment once the "startPreview" method is used.</li>
<li>All <code>preview_metadata</code> fields <strong>must</strong> be output only.</li>
<li><code>state</code> changes between <code>ACTIVE</code> and <code>SUSPENDED</code> when previewing is started
  or stopped. This happens when the "startPreview" or "stopPreview custom methods
  are invoked, respectively.</li>
<li>The first time the "startPreview" custom method is used, the system <strong>must</strong>
  create <code>preview_metadata</code> and do the following:</li>
<li>It <strong>must</strong> set the <code>state</code> to <code>ACTIVE</code></li>
<li>It <strong>must</strong> populate <code>start_time</code> with the current time.<ul>
<li><code>start_time</code> <strong>must</strong> be updated every time <code>state</code> is changed to
  <code>ACTIVE</code>.</li>
</ul>
</li>
<li>It <strong>must</strong> set a system generated <code>log_prefix</code> string, which is a
    predefined constant hard coded by the system developers.</li>
<li>The same value is used for previewing experiments for the given resource
    type. For example, "FirewallPolicyPreviewLog" for FirewallPolicy.</li>
<li>When the "stopPreview" custom method is used, the system <strong>must</strong> do the
  following:</li>
<li>It <strong>must</strong> set the <code>state</code> to <code>SUSPENDED</code></li>
<li>It <strong>must</strong> populate the <code>stop_time</code> with the current time.</li>
</ul>
<h3 id="methods">Methods</h3>
<h4 id="create">create</h4>
<ul>
<li>The resource <strong>must</strong> be created using long-running
  <a href="https://aip.dev/133#long-running-create">Create</a> and
  <code>google.longrunning.operation_info.response_type</code> <strong>must</strong> be
  <code>PolicyExperiment</code>.</li>
<li>Creating a new experiment to preview <strong>must</strong> support the following use
cases:</li>
<li>Preview a new policy.</li>
<li>Preview an update to an already live policy.</li>
<li>Preview a deletion of a current policy.</li>
<li>For the update and delete use cases, the <code>policy</code> field in the experiment
  <strong>must</strong> have the full payload of the live policy copied into it, including
  the name.</li>
<li>The user <strong>must</strong> set the rules to the new intended state to preview an
    update.</li>
<li>The user <strong>must</strong> set set the rules to represent a no-op to preview a
    delete.</li>
<li>To preview a new policy, the system must do the following:</li>
<li>If the system does not support a nested collection without a live policy,
    the user <strong>must</strong> create a live policy and set the rules to represent a
    no-op. For example, the rules of a no-op policy <strong>may</strong> be empty.<ul>
<li>An experiment is created as a child of the no-op policy.</li>
</ul>
</li>
<li>If the system supports previewing multiple experiments for a live policy,
  calling "create" more than once <strong>must</strong> create multiple experiments.</li>
</ul>
<h4 id="update">update</h4>
<ul>
<li>The resource <strong>must</strong> be updated using long-running
  <a href="https://aip.dev/134#long-running-update">Update</a> and
  <code>google.longrunning.operation_info.response_type</code> <strong>must</strong> be
  <code>PolicyExperiment</code>.</li>
<li>The name inside <code>policy</code> <strong>must not</strong> change but the other fields can in
  order to change the experiment being previewed because this <code>policy</code> is
  intended to replace the live policy, and the name of the live policy
  <strong>must not</strong> change.</li>
<li>The system <strong>must</strong> set the <code>state</code> to <code>SUSPENDED</code> if the <code>state</code> was <code>ACTIVE</code>
  at the time of an update.</li>
<li>This is so the user can easily distinguish between different versions of
    the experiment being previewed.</li>
</ul>
<h4 id="get">get</h4>
<ul>
<li>The standard method, <a href="https://aip.dev/131">Get</a>, <strong>must</strong> be included for
  <code>PolicyExperiment</code> resource types.</li>
</ul>
<h4 id="list">list</h4>
<ul>
<li>The standard method, <a href="https://aip.dev/132">List</a>, <strong>must</strong> be included for
  <code>PolicyExperiment</code> resource types.</li>
<li>Filtering on <code>PolicyPreviewMetadata</code> indicates which experiments are actively
  previewed.</li>
<li>For example, the following filter string returns a List response with
    experiments being previewed: preview_metadata.state = ACTIVE.</li>
</ul>
<h4 id="delete">delete</h4>
<ul>
<li>The resource <strong>must</strong> be deleted using long-running
  <a href="https://aip.dev/135#long-running-delete">Delete</a> and
  <code>google.longrunning.operation_info.response_type</code> <strong>must</strong> be
  <code>PolicyExperiment</code>.</li>
</ul>
<h4 id="startpreview">startPreview</h4>
<div class="highlight"><pre><span></span><code><span class="c1">// Starts previewing a PolicyExperiment. This triggers the system to start</span>
<span class="c1">// generating logs to evaluate the PolicyExperiment.</span>
<span class="k">rpc</span><span class="w"> </span><span class="n">StartPreviewPolicyExperiment</span><span class="p">(</span><span class="n">StartPreviewPolicyExperimentRequest</span><span class="p">)</span>
<span class="w">    </span><span class="k">returns</span><span class="w"> </span><span class="p">(</span><span class="n">google.longrunning.Operation</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">option</span><span class="w"> </span><span class="p">(</span><span class="n">google.api.http</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">post</span><span class="o">:</span><span class="w"> </span><span class="s">"/v1/{name=policies/*/experiments/*}:startPreview"</span>
<span class="w">    </span><span class="n">body</span><span class="o">:</span><span class="w"> </span><span class="s">"*"</span>
<span class="w">  </span><span class="p">};</span>
<span class="w">  </span><span class="k">option</span><span class="w"> </span><span class="p">(</span><span class="n">google.longrunning.operation_info</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">response_type</span><span class="o">:</span><span class="w"> </span><span class="s">"PolicyExperiment"</span>
<span class="w">    </span><span class="n">metadata_type</span><span class="o">:</span><span class="w"> </span><span class="s">"StartPreviewPolicyExperimentMetadata"</span>
<span class="w">  </span><span class="p">};</span>
<span class="p">}</span>

<span class="c1">// The request message for the startPreview custom method.</span>
<span class="kd">message</span><span class="w"> </span><span class="nc">StartPreviewPolicyExperimentRequest</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// The name of the PolicyExperiment.</span>
<span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>This custom method is required.</li>
<li><code>google.longrunning.Operation.metadata_type</code> <strong>must</strong> follow guidance on
  <a href="https://google.aip.dev/151">Long-running operations</a></li>
<li>This method <strong>must</strong> trigger the system to start generating logs to preview
  the experiment.</li>
<li>Whenever the method is called successfully, the system <strong>must</strong> set the
  following values in the <code>PolicyPreviewMetadata</code>:</li>
<li><code>log_prefix</code> to the predefined constant.</li>
<li><code>start_time</code> to the current time</li>
<li><code>state</code> to <code>ACTIVE</code>.</li>
<li>If the method is called on an experiment with the rules representing a no-op,
  then the system <strong>must</strong> preview the deletion of the live policy.</li>
</ul>
<h4 id="stoppreview">stopPreview</h4>
<div class="highlight"><pre><span></span><code><span class="c1">// Stops previewing a PolicyExperiment. This triggers the system to stop</span>
<span class="c1">// generating logs to evaluate the PolicyExperiment.</span>
<span class="k">rpc</span><span class="w"> </span><span class="n">StopPreviewPolicyExperiment</span><span class="p">(</span><span class="n">StopPreviewPolicyExperimentRequest</span><span class="p">)</span>
<span class="w">    </span><span class="k">returns</span><span class="w"> </span><span class="p">(</span><span class="n">google.longrunning.Operation</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">option</span><span class="w"> </span><span class="p">(</span><span class="n">google.api.http</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">post</span><span class="o">:</span><span class="w"> </span><span class="s">"/v1/{name=policies/*/experiments/*}:stopPreview"</span>
<span class="w">    </span><span class="n">body</span><span class="o">:</span><span class="w"> </span><span class="s">"*"</span>
<span class="w">  </span><span class="p">};</span>
<span class="w">  </span><span class="k">option</span><span class="w"> </span><span class="p">(</span><span class="n">google.longrunning.operation_info</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">response_type</span><span class="o">:</span><span class="w"> </span><span class="s">"PolicyExperiment"</span>
<span class="w">    </span><span class="n">metadata_type</span><span class="o">:</span><span class="w"> </span><span class="s">"StopPreviewPolicyExperimentMetadata"</span>
<span class="w">  </span><span class="p">};</span>
<span class="p">}</span>

<span class="c1">// The request message for the stopPreview custom method.</span>
<span class="kd">message</span><span class="w"> </span><span class="nc">StopPreviewPolicyExperimentRequest</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// The name of the PolicyExperiment.</span>
<span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>This custom method is required.</li>
<li><code>google.longrunning.Operation.metadata_type</code> <strong>must</strong> follow guidance on
  <a href="https://google.aip.dev/151">Long-running operations</a></li>
<li>This method <strong>must</strong> trigger the system to stop generating logs to preview the
  experiment.</li>
<li>Whenever the method is called successfully, the system <strong>must</strong> set the
  following values in the <code>PolicyPreviewMetadata</code>:</li>
<li><code>stop_time</code> to the current time</li>
<li><code>state</code> to <code>SUSPENDED</code></li>
</ul>
<h4 id="commit">commit</h4>
<p>The resource <strong>may</strong> expose a new custom method called "commit" to promote an
experiment. The system copies <code>policy</code> from the experiment into the live policy
and then deletes the experiment.</p>
<p>Declarative clients <strong>may</strong> manually copy fields from an experiment into the
live policy and then delete the experiment rather than calling "commit" if
preferable.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Commits a PolicyExperiment. This copies the PolicyExperiment's policy message</span>
<span class="c1">// to the live policy then deletes the PolicyExperiment.</span>
<span class="k">rpc</span><span class="w"> </span><span class="n">CommitPolicyExperiment</span><span class="p">(</span><span class="n">CommitPolicyExperimentRequest</span><span class="p">)</span>
<span class="w">    </span><span class="k">returns</span><span class="w"> </span><span class="p">(</span><span class="n">google.longrunning.Operation</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">option</span><span class="w"> </span><span class="p">(</span><span class="n">google.api.http</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">post</span><span class="o">:</span><span class="w"> </span><span class="s">"/v1/{name=policies/*/experiments/*}:commit"</span>
<span class="w">    </span><span class="n">body</span><span class="o">:</span><span class="w"> </span><span class="s">"*"</span>
<span class="w">  </span><span class="p">};</span>
<span class="w">  </span><span class="k">option</span><span class="w"> </span><span class="p">(</span><span class="n">google.longrunning.operation_info</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">response_type</span><span class="o">:</span><span class="w"> </span><span class="s">"google.protobuf.Empty"</span>
<span class="w">    </span><span class="n">metadata_type</span><span class="o">:</span><span class="w"> </span><span class="s">"CommitPolicyExperimentMetadata"</span>
<span class="w">  </span><span class="p">};</span>
<span class="p">}</span>

<span class="c1">// The request message for the commit custom method.</span>
<span class="kd">message</span><span class="w"> </span><span class="nc">CommitPolicyExperimentRequest</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="na">etag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="na">parent_etag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li><code>google.longrunning.Operation.metadata_type</code> <strong>must</strong> follow guidance on
  <a href="https://google.aip.dev/151">Long-running operations</a></li>
<li>The method <strong>must</strong> atomically copy <code>policy</code> from the experiment into the live
  policy, and then delete the experiment.</li>
<li>If any experiment fails "commit", previewing it <strong>must not</strong> stop, and the
  live policy <strong>must not</strong> be updated.</li>
<li>The method can be called on an experiment in any state.</li>
<li>The <code>etag</code> <strong>must</strong> match that of the experiment in order for commit to be
  successful. This is so the user does not commit an unintended version of the
  experiment.</li>
<li>If no <code>etag</code> is provided, the API <strong>must not</strong> succeed to prevent the user
    from unintentionally committing a different version of the experiment as
    intended.</li>
<li>A <code>parent_etag</code> <strong>may</strong> be provided to guarantee that the experiment
    overwrites a specific version of the live policy.</li>
<li>The method is not idempotent and calling it twice on the same experiment
  <strong>must</strong> return a 404 NOT_FOUND as the experiment is deleted as part of the
  first call.</li>
</ul>
<h3 id="changes-to-live-policy-api-methods">Changes to live policy API methods</h3>
<h4 id="delete_1">delete</h4>
<ul>
<li>A delete of the live policy <strong>must</strong> delete all experiments.</li>
<li>To maintain the experiments while negating the effect of the live policy, the
  live policy <strong>must</strong> be changed to a no-op policy instead of using this
  method.</li>
</ul>
<h3 id="logging">Logging</h3>
<p>Logging is crucial for the user to evaluate whether an experiment should be
promoted to live.</p>
<p>Logs <strong>must</strong> contain the results of the evaluated experiment, the <code>etag</code>
associated with that experiment alongside that of the live policy, and be
preceded by the value of <code>log_prefix</code>.
  - The <code>etag</code> fields help the user identify which
    configurations of the live and experiment are evaluated in the log.
  - <code>log_prefix</code> helps the user separate logs specifically generated for
    previewing the experiment from other use cases.</p>
<p>Overall, these logs help the user make a decision about whether to promote the
experiment to live.</p>
<h2 id="changelog">Changelog</h2>
<ul>
<li><strong>2023-04-27:</strong> Methods for start and stop renamed. State to enum. Annotations
  added.</li>
<li><strong>2023-03-30:</strong> Initial AIP written.</li>
</ul>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
<div class="md-copyright__highlight">
      TeamSystem S.p.A.
    </div>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<div class="md-progress" data-md-component="progress" role="progressbar"></div>
<script id="__config" type="application/json">{"base": "../..", "features": ["header.autohide", "icons", "navigation.collapsible", "navigation.footer", "navigation.instant", "navigation.instant.progress", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections"], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
<script src="../../assets/javascripts/bundle.83f73b43.min.js"></script>
<script src="https://code.iconify.design/3/3.1.0/iconify.min.js"></script>
<script>document$.subscribe(() => {
            window.update_swagger_ui_iframe_height = function (id) {
                var iFrameID = document.getElementById(id);
                if (iFrameID) {
                    full_height = (iFrameID.contentWindow.document.body.scrollHeight + 80) + "px";
                    iFrameID.height = full_height;
                    iFrameID.style.height = full_height;
                }
            }
        
            let iframe_id_list = []
            var iframes = document.getElementsByClassName("swagger-ui-iframe");
            for (var i = 0; i < iframes.length; i++) { 
                iframe_id_list.push(iframes[i].getAttribute("id"))
            }
        
            let ticking = true;
            
            document.addEventListener('scroll', function(e) {
                if (!ticking) {
                    window.requestAnimationFrame(()=> {
                        let half_vh = window.innerHeight/2;
                        for(var i = 0; i < iframe_id_list.length; i++) {
                            let element = document.getElementById(iframe_id_list[i])
                            if(element==null){
                                return
                            }
                            let diff = element.getBoundingClientRect().top
                            if(element.contentWindow.update_top_val){
                                element.contentWindow.update_top_val(half_vh - diff)
                            }
                        }
                        ticking = false;
                    });
                    ticking = true;
                }
            });
        
            const dark_scheme_name = "slate"
            
            window.scheme = document.body.getAttribute("data-md-color-scheme")
            const options = {
                attributeFilter: ['data-md-color-scheme'],
            };
            function color_scheme_callback(mutations) {
                for (let mutation of mutations) {
                    if (mutation.attributeName === "data-md-color-scheme") {
                        scheme = document.body.getAttribute("data-md-color-scheme")
                        var iframe_list = document.getElementsByClassName("swagger-ui-iframe")
                        for(var i = 0; i < iframe_list.length; i++) {
                            var ele = iframe_list.item(i);
                            if (ele) {
                                if (scheme === dark_scheme_name) {
                                    ele.contentWindow.enable_dark_mode();
                                } else {
                                    ele.contentWindow.disable_dark_mode();
                                }
                            }
                        }
                    }
                }
            }
            observer = new MutationObserver(color_scheme_callback);
            observer.observe(document.body, options);
            })</script></body>
</html>