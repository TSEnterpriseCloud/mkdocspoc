
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="Syncronize your data using Polling" name="description"/>
<link href="../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.5.42" name="generator"/>
<title>Syncronization using Polling - TeamSystem Enterprise Cloud</title>
<link href="../../assets/stylesheets/main.0253249f.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<link href="/static/css/custom.css" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet"/>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#football-lets-start">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="TeamSystem Enterprise Cloud" class="md-header__button md-logo" data-md-component="logo" href="../.." title="TeamSystem Enterprise Cloud">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            TeamSystem Enterprise Cloud
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Syncronization using Polling
            
          </span>
</div>
</div>
</div>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="TeamSystem Enterprise Cloud" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="TeamSystem Enterprise Cloud">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
    TeamSystem Enterprise Cloud
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
<span class="md-ellipsis">
    Getting Started
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_1_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_1">
<span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../started/getting-started/">
<span class="md-ellipsis">
    Introduction
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../started/authentication/">
<span class="md-ellipsis">
    Authentication
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../started/howto/">
<span class="md-ellipsis">
    How to
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
<span class="md-ellipsis">
    Step by step guide
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            Step by step guide
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../stepbystep/common-terms/">
<span class="md-ellipsis">
    Common Terms
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../stepbystep/company-scoped-methods/">
<span class="md-ellipsis">
    Company methods
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../stepbystep/manual-authentication/">
<span class="md-ellipsis">
    Authentication mode
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
<span class="md-ellipsis">
    Quickstarts
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            Quickstarts
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../stepbystep/quickstarts/postman-collection/">
<span class="md-ellipsis">
    Postaman Collections
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../stepbystep/quickstarts/csharp-sdk-quickstart/">
<span class="md-ellipsis">
    C# SDK Quickstart
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../stepbystep/quickstarts/go-sdk-quickstart/">
<span class="md-ellipsis">
    GO SDK Quickstart
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../stepbystep/quickstarts/java-sdk-quickstart/">
<span class="md-ellipsis">
    Java SDK Quickstart
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../stepbystep/quickstarts/js-sdk-quickstart/">
<span class="md-ellipsis">
    JavaScript SDK Quickstart
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../stepbystep/quickstarts/php-sdk-quickstart/">
<span class="md-ellipsis">
    PHP SDK Quickstart
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../stepbystep/quickstarts/python-sdk-quickstart/">
<span class="md-ellipsis">
    Python SDK Quickstart
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../stepbystep/quickstarts/ruby-sdk-quickstart/">
<span class="md-ellipsis">
    Ruby SDK Quickstart
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../stepbystep/quickstarts/ts-sdk-quickstart/">
<span class="md-ellipsis">
    TypeScript SDK Quickstart
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../stepbystep/quickstarts/vanilla-code/">
<span class="md-ellipsis">
    Vanilla Code Sample
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../stepbystep/quickstarts/windows-form-quickstart/">
<span class="md-ellipsis">
    Windows Form Quickstart
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../stepbystep/quickstarts/google-sheets-quickstart/">
<span class="md-ellipsis">
    Google Sheets Apps Script Quickstart
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../stepbystep/quickstarts/zapier-quickstart/">
<span class="md-ellipsis">
    Zapier Quickstart
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
<span class="md-ellipsis">
    Supported scenarios
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            Supported scenarios
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../anagrafiche/">
<span class="md-ellipsis">
    Anagrafiche
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../invoice-creation/">
<span class="md-ellipsis">
    Invoice creation
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../e-invoice-xml-customisation/">
<span class="md-ellipsis">
    E-Invoice XML Customisation
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
<span class="md-ellipsis">
    Basics
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            Basics
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../basics/scopes/">
<span class="md-ellipsis">
    Scopes
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../basics/errors/">
<span class="md-ellipsis">
    Errors
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../basics/limits-and-quotas/">
<span class="md-ellipsis">
    Limits adn Quotas
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
<span class="md-ellipsis">
    Additional capabilities
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_4_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_4">
<span class="md-nav__icon md-icon"></span>
            Additional capabilities
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../basics/additional-capabilities/sort-results/">
<span class="md-ellipsis">
    Sort Results
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../basics/additional-capabilities/paginate-results/">
<span class="md-ellipsis">
    Paginate results
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../basics/additional-capabilities/customize-response/">
<span class="md-ellipsis">
    Customize response
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../basics/additional-capabilities/filter-results/">
<span class="md-ellipsis">
    Filter results
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../basics/debug-your-integration/">
<span class="md-ellipsis">
    Debug your integration
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
<span class="md-ellipsis">
    Api Reference
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_6_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
            Api Reference
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../reference/api-reference-co/">
<span class="md-ellipsis">
    Common api
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../reference/api-reference-fi/">
<span class="md-ellipsis">
    Finance api
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../reference/api-reference-mg/">
<span class="md-ellipsis">
    Warehouse api
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../reference/api-reference/">
<span class="md-ellipsis">
    Use the API Reference
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_7" type="checkbox"/>
<label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
<span class="md-ellipsis">
    SDKs
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_7_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_7">
<span class="md-nav__icon md-icon"></span>
            SDKs
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../sdks/typescript-sdk/">
<span class="md-ellipsis">
    TypeScript SDK
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sdks/java-sdk/">
<span class="md-ellipsis">
    Java SDK
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sdks/javascript-sdk/">
<span class="md-ellipsis">
    JavaScript SDK
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sdks/net-sdk/">
<span class="md-ellipsis">
    .NET SDK
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sdks/python-sdk/">
<span class="md-ellipsis">
    Python SDK
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sdks/ruby-sdk/">
<span class="md-ellipsis">
    Ruby SDK
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_8" type="checkbox"/>
<label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
<span class="md-ellipsis">
    Support &amp; Feature Request
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_8_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_8">
<span class="md-nav__icon md-icon"></span>
            Support &amp; Feature Request
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../support/faq/">
<span class="md-ellipsis">
    FAQs
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../support/general-knowledge/oauth2/index.md">
<span class="md-ellipsis">
    General Knowledge
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_9" type="checkbox"/>
<label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
<span class="md-ellipsis">
    Legal
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_9_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_9">
<span class="md-nav__icon md-icon"></span>
            Legal
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../legal/terms/">
<span class="md-ellipsis">
    Condizioni generali di utilizzo delle API MadBit
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../legal/policy-acceptable-use/">
<span class="md-ellipsis">
    Policy di Acceptable Use
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../legal/marketing-resources-and-identity-guidelines/">
<span class="md-ellipsis">
    Marketing Resources and Identity Guidelines
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#football-lets-start">
<span class="md-ellipsis">
      :football:  Let's start!
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#building_construction-libraries">
<span class="md-ellipsis">
      :building_construction:  Libraries
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#one-initialize-our-sdk">
<span class="md-ellipsis">
      :one:  Initialize our SDK
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#two-implement-the-exponential-backoff">
<span class="md-ellipsis">
      :two:  Implement the Exponential Backoff
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#three-the-api-method">
<span class="md-ellipsis">
      :three:  The API Method
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#four-manage-the-response">
<span class="md-ellipsis">
      :four:  Manage the response
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#computer-code-examples">
<span class="md-ellipsis">
      :computer:  Code Examples
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#books-additional-resources">
<span class="md-ellipsis">
      :books:  Additional resources
    </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1>Syncronization using Polling</h1>
<p>import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";</p>
<p>In this use case, we suppose that you have a system that you want to <em>keep in sync with the TSE in Cloud API</em>, in particular <strong>retrieving the list of the products</strong> from our API and storing them in some way. In this example, we'll adopt a <strong>polling</strong> approach to retrieve the current state of the data stored in TSE in Cloud.</p>
<p>If you want to download the complete SDKs examples you can find them <a href="https://github.com/fattureincloud/fattureincloud-quickstarts/tree/master/polling">here</a>.</p>
<p>:::tip Retrieve your Company ID!</p>
<p>In this example, we'll suppose you have to manage just one Company, so we simply inserted its ID directly in the code. If instead, you need to be able to manage multiple companies, you'll need to retrieve the ID of the current company in some way.
Check the <a href="/basics/company-scoped-methods.mdx">Company-scoped Methods</a> page for more info.</p>
<p>:::</p>
<p>:::danger Are you sure?</p>
<p>A better approach is to use our <a href="/webhooks/index.mdx">Webhooks</a> to keep your system updated. Check them out!</p>
<p>:::</p>
<h2 id="football-lets-start">:football:  Let's start!</h2>
<p>To keep the code as simple as possible, we decided to write the data to a <a href="https://jsonlines.org/">JSON lines</a> file, that could be then sent as input for an external system; of course, it is possible to use the retrieved elements as needed: for example, to update a Database status or to perform API calls towards a third-party system.</p>
<p>:::warning Schedule the execution!</p>
<p>To keep two systems in sync using polling, it is necessary to reiterate the extraction of the data from our APIs, <a href="https://en.wikipedia.org/wiki/Cron">scheduling</a> the code execution.</p>
<p>In this example, we <em>deliberately</em> omitted to add the code to repeat the execution of our code. For example, you could decide to add a <strong>Cron Library</strong> to your application or to execute the script using a <strong>Job Scheduler</strong> on your operating system. <strong>This is up to you</strong>.</p>
<p>:::</p>
<p>:::info Or execute it once...</p>
<p>Even if we created this code to keep two systems synchronized periodically, it can also be used for a one-off extraction of the data from the TSE in Cloud API. Just execute it as it is...</p>
<p>:::</p>
<h2 id="building_construction-libraries">:building_construction:  Libraries</h2>
<p>In our examples, we'll use the <strong>TSE in Cloud SDKs</strong>; of course, you can just replace our SDKs with a simple HTTP Client if you prefer: check the <a href="/sdks/index.mdx">dedicated page</a> for further info.
Additionally, for some languages, we added some other libraries to perform common tasks such as writing to the file system or performing the exponential backoff.</p>
<h2 id="one-initialize-our-sdk">:one:  Initialize our SDK</h2>
<p>In the first part of this example, we import our SDK and initialize it, using the Access Token requested to perform the API call. For simplicity, we didn't implement the code to retrieve the access token in these examples, but you can find more information in the <a href="/quickstarts/index.mdx">Quickstarts</a> or in the <a href="/authentication/index.mdx">Authentication Implementation</a> pages.</p>
<p>Since we're trying to collect the list of products for a certain company, the <strong>products:r</strong> <a href="/basics/scopes.md">scope</a> will be required; if you need to use another API method please select the appropriate scopes.</p>
<p>Once the token is provided to our SDK, it is possible to start using it to interrogate our APIs.</p>
<h2 id="two-implement-the-exponential-backoff">:two:  Implement the Exponential Backoff</h2>
<p>The <strong>polling strategy</strong> implies the exigency to perform a potentially huge amount of requests in a really short period. As explained <a href="/basics/limits-and-quotas.mdx">here</a>, our APIs are protected by a set of limits that could result in an error if too many requests are performed in a certain interval.</p>
<p>This is why in our examples we wrapped the API call with an <a href="https://en.wikipedia.org/wiki/Exponential_backoff">Exponential Backoff</a> method: it manages retries and time distance between two consecutive attempts, to avoid your script failing for a temporary quota-related issue.</p>
<h2 id="three-the-api-method">:three:  The API Method</h2>
<p>The API method that we're using is the <a href="/api-reference#get-/c/-company_id-/products">List Products</a> method, which returns the list of all the possible products for a certain company.
The <em>List</em> methods provide <a href="/basics/additional-capabilities/sort-results.mdx">Sorting</a> and <a href="/basics/additional-capabilities/customize-response.mdx">Customizing</a> functionalities, but in this example we'll not use them.</p>
<p>Each response of the List methods will be <a href="/basics/additional-capabilities/paginate-results.mdx">Paginated</a>: to avoid returning enormous amounts of data with a single call, the list of products will be split into different pages, that can be retrieved consecutively. Each response contains a set of dedicated pagination parameters, that are meant to make the pages navigation task easier for you.</p>
<p>In our code, we'll perform the first List request on the first page provided by our API, with a page size of five elements. Then we'll use the pagination parameter <em>last_page</em> to retrieve the subsequent pages, performing the needed number of API calls to export all the needed elements from the APIs.</p>
<p>:::danger Be aware of the index!</p>
<p>Please, notice that the pages on our APIs use <em>one-based numbering</em>: the first page has index 1.</p>
<p>:::</p>
<h2 id="four-manage-the-response">:four:  Manage the response</h2>
<p>Each response contains a <em>data</em> parameter, that is a JSON array representing one page (e.g. one subset of the list of products). Our SDKs parse the JSON array, so you can just use the elements contained in the array to perform the requested operations.</p>
<p>In this example, we're just trying to populate a JSON Lines file, so for each product retrieved we obtain the related JSON representation and append it to the text file.</p>
<h2 id="computer-code-examples">:computer:  Code Examples</h2>
<p>Here you can find the code described above.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// The following dependencies are required</span>
<span class="c1">// dotnet add package It.FattureInCloud.Sdk</span>
<span class="c1">// dotnet add package Polly</span>
<span class="c1">// dotnet add package Polly.Contrib.WaitAndRetry</span>

<span class="k">using</span><span class="w"> </span><span class="nn">System</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">System.IO</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">System.Linq</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">Newtonsoft.Json</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">Polly</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">It.FattureInCloud.Sdk.Api</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">It.FattureInCloud.Sdk.Model</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">It.FattureInCloud.Sdk.Client</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">Polly.Contrib.WaitAndRetry</span><span class="p">;</span>

<span class="k">namespace</span><span class="w"> </span><span class="nn">poll</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">class</span><span class="w"> </span><span class="nc">Program</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">ProductsApi</span><span class="w"> </span><span class="n">apiInstance</span><span class="p">;</span>

<span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// This code should be executed periodically using a cron library or job scheduler.</span>
<span class="w">            </span><span class="c1">// For example: https://www.quartz-scheduler.net/</span>
<span class="w">            </span><span class="n">SyncProducts</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">private</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">SyncProducts</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Here we init the TSE in Cloud SDK</span>
<span class="w">            </span><span class="c1">// The Access Token is retrieved using the "GetToken" method</span>
<span class="w">            </span><span class="n">Configuration</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Configuration</span><span class="p">();</span>
<span class="w">            </span><span class="n">config</span><span class="p">.</span><span class="n">AccessToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetToken</span><span class="p">();</span>

<span class="w">            </span><span class="c1">// In this example we're using the Products API</span>
<span class="w">            </span><span class="n">apiInstance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ProductsApi</span><span class="p">(</span><span class="n">config</span><span class="p">);</span>

<span class="w">            </span><span class="c1">// The ID of the controlled company.</span>
<span class="w">            </span><span class="kt">var</span><span class="w"> </span><span class="n">companyId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">;</span>

<span class="w">            </span><span class="c1">// Here we setup the exponential backoff config</span>
<span class="w">            </span><span class="kt">var</span><span class="w"> </span><span class="n">maxRetryAttempts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">;</span>
<span class="w">            </span><span class="kt">var</span><span class="w"> </span><span class="n">pauseBetweenFailures</span><span class="w"> </span><span class="o">=</span>
<span class="w">                </span><span class="n">Backoff</span><span class="p">.</span><span class="n">ExponentialBackoff</span><span class="p">(</span><span class="n">TimeSpan</span><span class="p">.</span><span class="n">FromSeconds</span><span class="p">(</span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="n">retryCount</span><span class="p">:</span><span class="w"> </span><span class="n">maxRetryAttempts</span><span class="p">);</span>

<span class="w">            </span><span class="kt">var</span><span class="w"> </span><span class="n">retryPolicy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Policy</span>
<span class="w">                </span><span class="p">.</span><span class="n">WaitAndRetry</span><span class="p">(</span><span class="n">pauseBetweenFailures</span><span class="p">);</span>

<span class="w">            </span><span class="k">try</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// In this example we suppose to export the data to a JSON Lines file.</span>
<span class="w">                </span><span class="c1">// First, we cancel the content of the destination file</span>
<span class="w">                </span><span class="n">File</span><span class="p">.</span><span class="n">WriteAllText</span><span class="p">(</span><span class="s">"products.jsonl"</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="p">.</span><span class="n">Empty</span><span class="p">);</span>

<span class="w">                </span><span class="c1">// List Products</span>
<span class="w">                </span><span class="kt">var</span><span class="w"> </span><span class="n">perPage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">;</span>

<span class="w">                </span><span class="c1">// We perform the first request</span>
<span class="w">                </span><span class="n">ListProductsResponse</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span>
<span class="w">                    </span><span class="n">ListProductsWithBackoff</span><span class="p">(</span><span class="n">companyId</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">perPage</span><span class="p">,</span><span class="w"> </span><span class="n">retryPolicy</span><span class="p">,</span><span class="w"> </span><span class="n">apiInstance</span><span class="p">);</span>
<span class="w">                </span><span class="c1">// We use the first response to extract the last page index</span>
<span class="w">                </span><span class="kt">var</span><span class="w"> </span><span class="n">lastPage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="n">LastPage</span><span class="p">;</span>
<span class="w">                </span><span class="c1">// We append the products obtained with the first request top the output file</span>
<span class="w">                </span><span class="c1">// Data contains an array of products</span>
<span class="w">                </span><span class="n">AppendProductsToFile</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">Data</span><span class="p">);</span>

<span class="w">                </span><span class="c1">// For the missing pages (we already requested the first one)</span>
<span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">lastPage</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="c1">// We require the page to the API</span>
<span class="w">                    </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ListProductsWithBackoff</span><span class="p">(</span><span class="n">companyId</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">perPage</span><span class="p">,</span><span class="w"> </span><span class="n">retryPolicy</span><span class="p">,</span><span class="w"> </span><span class="n">apiInstance</span><span class="p">);</span>
<span class="w">                    </span><span class="c1">// And append all the retrieved products</span>
<span class="w">                    </span><span class="n">AppendProductsToFile</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">Data</span><span class="p">);</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">ApiException</span><span class="w"> </span><span class="n">ex</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">"Exception when calling ProductsAPI.ListProducts: "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ex</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
<span class="w">                </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">"Status Code: "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ex</span><span class="p">.</span><span class="n">ErrorCode</span><span class="p">);</span>
<span class="w">                </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">ex</span><span class="p">.</span><span class="n">StackTrace</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// In this function we append the products in the JSON Lines file.</span>
<span class="w">        </span><span class="c1">// You can replace this function to perform the operations you need.</span>
<span class="w">        </span><span class="c1">// For example, you can build SQL queries or call a third-party API using the retrieved products.</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">StreamWriter</span><span class="w"> </span><span class="n">sw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">File</span><span class="p">.</span><span class="n">AppendText</span><span class="p">(</span><span class="s">"products.jsonl"</span><span class="p">);</span>
<span class="w">            </span><span class="c1">// For each product in the list</span>
<span class="w">            </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="n">Product</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">products</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// We write the product to the file</span>
<span class="w">                </span><span class="n">sw</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">JsonConvert</span><span class="p">.</span><span class="n">SerializeObject</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">Formatting</span><span class="p">.</span><span class="n">None</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">"\n"</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="n">sw</span><span class="p">.</span><span class="n">Close</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// Here we wrap the SDK method with an exponential backoff</span>
<span class="w">        </span><span class="c1">// This is to manage the quota exceeded issue</span>
<span class="w">        </span><span class="k">private</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">ListProductsResponse</span><span class="w"> </span><span class="nf">ListProductsWithBackoff</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">companyId</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">currentPage</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">perPage</span><span class="p">,</span><span class="w"> </span><span class="n">Policy</span><span class="w"> </span><span class="n">retryPolicy</span><span class="p">,</span><span class="w"> </span><span class="n">ProductsApi</span><span class="w"> </span><span class="n">apiInstance</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">retryPolicy</span><span class="p">.</span><span class="n">Execute</span><span class="p">(()</span><span class="w"> </span><span class="o">=&gt;</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// The actual SDK method is executed here</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">apiInstance</span><span class="p">.</span><span class="n">ListProducts</span><span class="p">(</span><span class="n">companyId</span><span class="p">,</span><span class="w"> </span><span class="k">null</span><span class="p">,</span><span class="w"> </span><span class="s">"detailed"</span><span class="p">,</span><span class="w"> </span><span class="k">null</span><span class="p">,</span><span class="w"> </span><span class="n">currentPage</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">);</span>
<span class="w">            </span><span class="p">});</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// This is just a mock: this function should contain the code to retrieve the Access Token</span>
<span class="w">        </span><span class="k">private</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="nf">GetToken</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="s">"YOUR_TOKEN"</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">// The following dependencies is required</span>
<span class="c1">// go get github.com/fattureincloud/fattureincloud-go-sdk/</span>
<span class="c1">// go get github.com/cenkalti/backoff/v4</span>

<span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">"context"</span>
<span class="w">    </span><span class="s">"encoding/json"</span>
<span class="w">    </span><span class="s">"fmt"</span>
<span class="w">    </span><span class="s">"os"</span>

<span class="w">    </span><span class="nx">backoff</span><span class="w"> </span><span class="s">"github.com/cenkalti/backoff/v4"</span>
<span class="w">    </span><span class="nx">fattureincloudapi</span><span class="w"> </span><span class="s">"github.com/fattureincloud/fattureincloud-go-sdk/v2/api"</span>
<span class="w">    </span><span class="nx">fattureincloud</span><span class="w"> </span><span class="s">"github.com/fattureincloud/fattureincloud-go-sdk/v2/model"</span>
<span class="p">)</span>

<span class="kd">var</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="nx">f</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">OpenFile</span><span class="p">(</span><span class="s">"products.jsonl"</span><span class="p">,</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">O_APPEND</span><span class="o">|</span><span class="nx">os</span><span class="p">.</span><span class="nx">O_WRONLY</span><span class="p">,</span><span class="w"> </span><span class="mo">0644</span><span class="p">)</span>
<span class="w">    </span><span class="c1">// The Access Token is retrieved using the "getToken" method</span>
<span class="w">    </span><span class="nx">auth</span><span class="w">          </span><span class="p">=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">WithValue</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">(),</span><span class="w"> </span><span class="nx">fattureincloudapi</span><span class="p">.</span><span class="nx">ContextAccessToken</span><span class="p">,</span><span class="w"> </span><span class="nx">getToken</span><span class="p">())</span>
<span class="w">    </span><span class="nx">configuration</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">fattureincloudapi</span><span class="p">.</span><span class="nx">NewConfiguration</span><span class="p">()</span>
<span class="w">    </span><span class="nx">apiClient</span><span class="w">     </span><span class="p">=</span><span class="w"> </span><span class="nx">fattureincloudapi</span><span class="p">.</span><span class="nx">NewAPIClient</span><span class="p">(</span><span class="nx">configuration</span><span class="p">)</span>
<span class="w">    </span><span class="nx">companyId</span><span class="w">     </span><span class="p">=</span><span class="w"> </span><span class="nb">int32</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span><span class="w"> </span><span class="c1">// This is the ID of the company we're working on</span>
<span class="w">    </span><span class="c1">// Here we define the parameters for the first request.</span>
<span class="w">    </span><span class="nx">nextPage</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="nx">attempts</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// This code should be executed periodically using a cron library or job scheduler.</span>
<span class="w">    </span><span class="nx">syncProducts</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">syncProducts</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// In this example we suppose to export the data to a JSON Lines file.</span>
<span class="w">    </span><span class="c1">// First, we cancel the content of the destination file</span>
<span class="w">    </span><span class="nx">f</span><span class="p">.</span><span class="nx">Truncate</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="c1">// Here we define the operation that retrieves the products</span>
<span class="w">    </span><span class="nx">operation</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">attempts</span><span class="o">++</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">"Attempt: %d\n"</span><span class="p">,</span><span class="w"> </span><span class="nx">attempts</span><span class="p">)</span>
<span class="w">        </span><span class="c1">// In this example we're using the Products API</span>
<span class="w">        </span><span class="c1">// Here we execute the actual SDK method</span>
<span class="w">        </span><span class="nx">resp</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">apiClient</span><span class="p">.</span><span class="nx">ProductsAPI</span><span class="p">.</span><span class="nx">ListProducts</span><span class="p">(</span><span class="nx">auth</span><span class="p">,</span><span class="w"> </span><span class="nx">companyId</span><span class="p">).</span><span class="nx">Page</span><span class="p">(</span><span class="nb">int32</span><span class="p">(</span><span class="nx">nextPage</span><span class="p">)).</span><span class="nx">PerPage</span><span class="p">(</span><span class="mi">5</span><span class="p">).</span><span class="nx">Execute</span><span class="p">()</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">resp</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// We check if there are other pages to retrieve</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">resp</span><span class="p">.</span><span class="nx">NextPageUrl</span><span class="p">.</span><span class="nx">Get</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">nextPage</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">nextPage</span><span class="o">++</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="c1">// We write the products of this page to the file</span>
<span class="w">            </span><span class="c1">// "data" contains an array of products</span>
<span class="w">            </span><span class="nx">appendProductsToFile</span><span class="p">(</span><span class="nx">resp</span><span class="p">.</span><span class="nx">Data</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// For all the pages</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">nextPage</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">attempts</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">        </span><span class="c1">// We call the operation function using Exponential Backoff</span>
<span class="w">        </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">backoff</span><span class="p">.</span><span class="nx">Retry</span><span class="p">(</span><span class="nx">operation</span><span class="p">,</span><span class="w"> </span><span class="nx">backoff</span><span class="p">.</span><span class="nx">NewExponentialBackOff</span><span class="p">())</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintf</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Stderr</span><span class="p">,</span><span class="w"> </span><span class="s">"Error %v\n"</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">f</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"products succesfully retrieved and saved in ./products.jsonl"</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// In this function we append the products in the JSON Lines file.</span>
<span class="c1">// You can replace this function to perform the operations you need.</span>
<span class="c1">// For example, you can build SQL queries or call a third-party API using the retrieved products.</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">appendProductsToFile</span><span class="p">(</span><span class="nx">products</span><span class="w"> </span><span class="p">[]</span><span class="nx">fattureincloud</span><span class="p">.</span><span class="nx">Product</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// For each product in the array</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">element</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">products</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// We obtain the related JSON and append it to the file as single line</span>
<span class="w">        </span><span class="nx">jsonStr</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">json</span><span class="p">.</span><span class="nx">Marshal</span><span class="p">(</span><span class="nx">element</span><span class="p">)</span>
<span class="w">        </span><span class="nx">f</span><span class="p">.</span><span class="nx">WriteString</span><span class="p">(</span><span class="nb">string</span><span class="p">(</span><span class="nx">jsonStr</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">"\n"</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// This is just a mock: this function should contain the code to retrieve the Access Token</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">getToken</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">"YOUR_TOKEN"</span>
<span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">com.google.gson.Gson</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">io.github.resilience4j.core.IntervalFunction</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">io.github.resilience4j.retry.Retry</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">io.github.resilience4j.retry.RetryConfig</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">io.github.resilience4j.retry.RetryRegistry</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">io.vavr.CheckedFunction0</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">it.fattureincloud.sdk.ApiClient</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">it.fattureincloud.sdk.ApiException</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">it.fattureincloud.sdk.Configuration</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">it.fattureincloud.sdk.api.ProductsApi</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">it.fattureincloud.sdk.auth.OAuth</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">it.fattureincloud.sdk.model.ListProductsResponse</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">it.fattureincloud.sdk.model.Product</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.io.IOException</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.nio.file.Files</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.nio.file.Paths</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.nio.file.StandardOpenOption</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Application</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Throwable</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// This code should be executed periodically using a cron library or job scheduler.</span>
<span class="w">        </span><span class="c1">// For example: http://www.quartz-scheduler.org/</span>
<span class="w">        </span><span class="n">syncProducts</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">syncProducts</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Throwable</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="c1">// Here we init the TSE in Cloud SDK</span>
<span class="w">        </span><span class="n">ApiClient</span><span class="w"> </span><span class="n">defaultClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Configuration</span><span class="p">.</span><span class="na">getDefaultApiClient</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// The Access Token is retrieved using the "getToken" method</span>
<span class="w">        </span><span class="n">OAuth</span><span class="w"> </span><span class="n">OAuth2AuthenticationCodeFlow</span><span class="w"> </span><span class="o">=</span>
<span class="w">            </span><span class="p">(</span><span class="n">OAuth</span><span class="p">)</span><span class="w"> </span><span class="n">defaultClient</span><span class="p">.</span><span class="na">getAuthentication</span><span class="p">(</span><span class="s">"OAuth2AuthenticationCodeFlow"</span><span class="p">);</span>
<span class="w">        </span><span class="n">OAuth2AuthenticationCodeFlow</span><span class="p">.</span><span class="na">setAccessToken</span><span class="p">(</span><span class="n">getToken</span><span class="p">());</span>

<span class="w">        </span><span class="c1">// In this example we're using the Products API</span>
<span class="w">        </span><span class="n">ProductsApi</span><span class="w"> </span><span class="n">apiInstance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ProductsApi</span><span class="p">(</span><span class="n">defaultClient</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// The ID of the controlled company.</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">companyId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>

<span class="w">        </span><span class="c1">// Here we setup the exponential backoff config</span>
<span class="w">        </span><span class="n">RetryConfig</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RetryConfig</span><span class="p">.</span><span class="na">custom</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">maxAttempts</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">retryExceptions</span><span class="p">(</span><span class="n">ApiException</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">intervalFunction</span><span class="p">(</span><span class="n">IntervalFunction</span><span class="p">.</span><span class="na">ofExponentialBackoff</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">))</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>

<span class="w">        </span><span class="n">RetryRegistry</span><span class="w"> </span><span class="n">registry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RetryRegistry</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">config</span><span class="p">);</span>
<span class="w">        </span><span class="n">Retry</span><span class="w"> </span><span class="n">retry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">registry</span><span class="p">.</span><span class="na">retry</span><span class="p">(</span><span class="s">"listProducts"</span><span class="p">,</span><span class="w"> </span><span class="n">config</span><span class="p">);</span>

<span class="w">        </span><span class="n">Retry</span><span class="p">.</span><span class="na">EventPublisher</span><span class="w"> </span><span class="n">publisher</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">retry</span><span class="p">.</span><span class="na">getEventPublisher</span><span class="p">();</span>
<span class="w">        </span><span class="n">publisher</span><span class="p">.</span><span class="na">onRetry</span><span class="p">(</span><span class="n">event</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">toString</span><span class="p">()));</span>

<span class="w">        </span><span class="c1">// In this example we suppose to export the data to a JSON Lines file.</span>
<span class="w">        </span><span class="c1">// First, we cancel the content of the destination file</span>
<span class="w">        </span><span class="n">Files</span><span class="p">.</span><span class="na">write</span><span class="p">(</span><span class="n">Paths</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">"products.jsonl"</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">""</span><span class="p">).</span><span class="na">getBytes</span><span class="p">(),</span>
<span class="w">            </span><span class="n">StandardOpenOption</span><span class="p">.</span><span class="na">CREATE</span><span class="p">,</span><span class="w"> </span><span class="n">StandardOpenOption</span><span class="p">.</span><span class="na">TRUNCATE_EXISTING</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// List Products</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">perPage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>

<span class="w">        </span><span class="c1">// We perform the first request</span>
<span class="w">        </span><span class="n">ListProductsResponse</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">listProductsWithBackoff</span><span class="p">(</span><span class="n">companyId</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">perPage</span><span class="p">,</span><span class="w"> </span><span class="n">retry</span><span class="p">,</span><span class="w"> </span><span class="n">apiInstance</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// We use the first response to extract the last page index</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">lastPage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="na">getLastPage</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// We append the products obtained with the first request top the output file</span>
<span class="w">        </span><span class="c1">// Data contains an array of products</span>
<span class="w">        </span><span class="n">appendProductsToFile</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">getData</span><span class="p">());</span>

<span class="w">        </span><span class="c1">// For the missing pages (we already requested the first one)</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">lastPage</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// We require the page to the API</span>
<span class="w">            </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">listProductsWithBackoff</span><span class="p">(</span><span class="n">companyId</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">perPage</span><span class="p">,</span><span class="w"> </span><span class="n">retry</span><span class="p">,</span><span class="w"> </span><span class="n">apiInstance</span><span class="p">);</span>
<span class="w">            </span><span class="c1">// And append all the retrieved products</span>
<span class="w">            </span><span class="n">appendProductsToFile</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">getData</span><span class="p">());</span>

<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Here we wrap the SDK method with an exponential backoff</span>
<span class="w">    </span><span class="c1">// This is to manage the quota exceeded issue</span>
<span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="n">ListProductsResponse</span><span class="w"> </span><span class="nf">listProductsWithBackoff</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">companyId</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">currentPage</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">perPage</span><span class="p">,</span>
<span class="w">            </span><span class="n">Retry</span><span class="w"> </span><span class="n">retry</span><span class="p">,</span><span class="w"> </span><span class="n">ProductsApi</span><span class="w"> </span><span class="n">apiInstance</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Throwable</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">Retry</span><span class="p">.</span><span class="na">decorateCheckedSupplier</span><span class="p">(</span><span class="n">retry</span><span class="p">,</span>
<span class="w">                        </span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">apiInstance</span><span class="p">.</span><span class="na">listProducts</span><span class="p">(</span><span class="n">companyId</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="s">"detailed"</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="n">currentPage</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">));</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">retryingListSuppliers</span><span class="p">.</span><span class="na">apply</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Product</span><span class="w"> </span><span class="n">product</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">products</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Gson</span><span class="p">().</span><span class="na">toJson</span><span class="p">(</span><span class="n">product</span><span class="p">);</span>
<span class="w">            </span><span class="n">Files</span><span class="p">.</span><span class="na">write</span><span class="p">(</span><span class="n">Paths</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">"products.jsonl"</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">lineSeparator</span><span class="p">()).</span><span class="na">getBytes</span><span class="p">(),</span>
<span class="w">                </span><span class="n">StandardOpenOption</span><span class="p">.</span><span class="na">CREATE</span><span class="p">,</span><span class="w"> </span><span class="n">StandardOpenOption</span><span class="p">.</span><span class="na">APPEND</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// This is just a mock: this function should contain the code to retrieve the Access Token</span>
<span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getToken</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">"YOUR_TOKEN"</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">// The following dependency is required</span>
<span class="c1">// yarn add @fattureincloud/fattureincloud-js-sdk</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">fs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s2">"fs"</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">fattureInCloudSdk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s2">"@fattureincloud/fattureincloud-js-sdk"</span><span class="p">);</span>

<span class="c1">// Here we init the TSE in Cloud SDK</span>
<span class="c1">// The Access Token is retrieved using the "getToken" method</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">defaultClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fattureInCloudSdk</span><span class="p">.</span><span class="nx">ApiClient</span><span class="p">.</span><span class="nx">instance</span><span class="p">;</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">OAuth2AuthenticationCodeFlow</span><span class="w"> </span><span class="o">=</span>
<span class="w">  </span><span class="nx">defaultClient</span><span class="p">.</span><span class="nx">authentications</span><span class="p">[</span><span class="s2">"OAuth2AuthenticationCodeFlow"</span><span class="p">];</span>
<span class="nx">OAuth2AuthenticationCodeFlow</span><span class="p">.</span><span class="nx">accessToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getToken</span><span class="p">();</span>

<span class="c1">// In this example we're using the Products API</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">productsApiInstance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">fattureInCloudSdk</span><span class="p">.</span><span class="nx">ProductsApi</span><span class="p">();</span>

<span class="c1">// This code should be executed periodically using a cron library or job scheduler.</span>
<span class="c1">// For example: https://www.npmjs.com/package/node-cron</span>
<span class="nx">main</span><span class="p">()</span>
<span class="w">  </span><span class="p">.</span><span class="nx">then</span><span class="p">()</span>
<span class="w">  </span><span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">));</span>

<span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// In this example we suppose to export the data to a JSON Lines file.</span>
<span class="w">  </span><span class="c1">// First, we cancel the content of the destination file</span>
<span class="w">  </span><span class="nx">fs</span><span class="p">.</span><span class="nx">truncate</span><span class="p">(</span><span class="s2">"./products.jsonl"</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="w">      </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="c1">// Here we define the parameters for the first request.</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">opts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fields</span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">    </span><span class="nx">fieldset</span><span class="o">:</span><span class="w"> </span><span class="s2">"detailed"</span><span class="p">,</span>
<span class="w">    </span><span class="nx">sort</span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">    </span><span class="nx">page</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="c1">// We're trying to obtain the first page</span>
<span class="w">    </span><span class="nx">perPage</span><span class="o">:</span><span class="w"> </span><span class="mf">5</span><span class="p">,</span><span class="w"> </span><span class="c1">// Every page will contain at most 5 products</span>
<span class="w">  </span><span class="p">};</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">companyId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2</span><span class="p">;</span><span class="w"> </span><span class="c1">// This is the ID of the company we're working on</span>

<span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// We perform the first request</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">listProductsWithBackoff</span><span class="p">(</span><span class="nx">companyId</span><span class="p">,</span><span class="w"> </span><span class="nx">opts</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// We recover the last page index</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">lastPage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">result</span><span class="p">[</span><span class="s2">"last_page"</span><span class="p">];</span>
<span class="w">    </span><span class="c1">// We write the products of this page to the file</span>
<span class="w">    </span><span class="c1">// "data" contains an array of products</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">appendProductsToFile</span><span class="p">(</span><span class="nx">result</span><span class="p">[</span><span class="s2">"data"</span><span class="p">]);</span>

<span class="w">    </span><span class="c1">// For all the remaining pages (we already have the first one)</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nx">lastPage</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// We update the page index</span>
<span class="w">      </span><span class="nx">opts</span><span class="p">[</span><span class="s2">"page"</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">i</span><span class="p">;</span>
<span class="w">      </span><span class="c1">// We require the page at the selected index</span>
<span class="w">      </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">listProductsWithBackoff</span><span class="p">(</span><span class="nx">companyId</span><span class="p">,</span><span class="w"> </span><span class="nx">opts</span><span class="p">);</span>
<span class="w">      </span><span class="c1">// And we write the products to the file</span>
<span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">appendProductsToFile</span><span class="p">(</span><span class="nx">result</span><span class="p">[</span><span class="s2">"data"</span><span class="p">]);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"products succesfully retrieved and saved in ./products.jsonl"</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// In this function we append the products in the JSON Lines file.</span>
<span class="c1">// You can replace this function to perform the operations you need.</span>
<span class="c1">// For example, you can build SQL queries or call a third-party API using the retrieved products.</span>
<span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">appendProductsToFile</span><span class="p">(</span><span class="nx">products</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// For each product in the array</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">products</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">product</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">products</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
<span class="w">    </span><span class="c1">// We obtain the related JSON and append it to the file as single line</span>
<span class="w">    </span><span class="nx">fs</span><span class="p">.</span><span class="nx">appendFileSync</span><span class="p">(</span>
<span class="w">      </span><span class="s2">"./products.jsonl"</span><span class="p">,</span>
<span class="w">      </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">product</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">"\n"</span><span class="p">,</span>
<span class="w">      </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="w">          </span><span class="k">return</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Here we wrap the SDK method with an exponential backoff</span>
<span class="c1">// This is to manage the quota exceeded issue</span>
<span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">listProductsWithBackoff</span><span class="p">(</span><span class="nx">companyId</span><span class="p">,</span><span class="w"> </span><span class="nx">opts</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">var</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">delay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">retryCount</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">    </span><span class="ow">new</span><span class="w"> </span><span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="w"> </span><span class="o">**</span><span class="w"> </span><span class="nx">retryCount</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1000</span><span class="p">));</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">getProd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">retryCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">lastError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">retryCount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">20</span><span class="p">)</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="nx">lastError</span><span class="p">);</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"attempt:"</span><span class="p">,</span><span class="w"> </span><span class="nx">count</span><span class="o">++</span><span class="p">,</span><span class="w"> </span><span class="s2">"wait:"</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="w"> </span><span class="o">**</span><span class="w"> </span><span class="nx">retryCount</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1000</span><span class="p">);</span>
<span class="w">      </span><span class="c1">// The actual SDK method is executed here</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">productsApiInstance</span><span class="p">.</span><span class="nx">listProducts</span><span class="p">(</span><span class="nx">companyId</span><span class="p">,</span><span class="w"> </span><span class="nx">opts</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">delay</span><span class="p">(</span><span class="nx">retryCount</span><span class="p">);</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">getProd</span><span class="p">(</span><span class="nx">retryCount</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nx">e</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">};</span>
<span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">getProd</span><span class="p">();</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// This is just a mock: this function should contain the code to retrieve the Access Token</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">getToken</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="s2">"YOUR_TOKEN"</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
<span class="k">require</span><span class="p">(</span><span class="s2">"vendor/autoload.php"</span><span class="p">);</span>
<span class="c1">// The following dependencies are required</span>
<span class="c1">// composer require stechstudio/backoff</span>
<span class="c1">// composer require fattureincloud/fattureincloud-php-sdk</span>

<span class="k">use</span> <span class="nx">FattureInCloud\Api\ProductsApi</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">FattureInCloud\Configuration</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">GuzzleHttp\Client</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">STS\Backoff\Backoff</span><span class="p">;</span>

<span class="c1">// This code should be executed periodically using a cron library or job scheduler.</span>
<span class="c1">// For example: https://github.com/Cron/Cron</span>

<span class="c1">// Here we init the TSE in Cloud SDK</span>
<span class="c1">// The Access Token is retrieved using the "getToken" method</span>
<span class="nv">$config</span> <span class="o">=</span> <span class="nx">Configuration</span><span class="o">::</span><span class="na">getDefaultConfiguration</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">setAccessToken</span><span class="p">(</span><span class="nx">getToken</span><span class="p">());</span>
<span class="c1">// In this example we're using the Products API</span>
<span class="nv">$productsApiInstance</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ProductsApi</span><span class="p">(</span>
    <span class="k">new</span> <span class="nx">Client</span><span class="p">(),</span>
    <span class="nv">$config</span>
<span class="p">);</span>

<span class="c1">// In this example we suppose to export the data to a JSON Lines file.</span>
<span class="c1">// First, we cancel the content of the destination file</span>
<span class="nb">file_put_contents</span><span class="p">(</span><span class="s2">"./products.jsonl"</span><span class="p">,</span> <span class="s2">""</span><span class="p">);</span>

<span class="c1">// This is the ID of the company we're currently managing</span>
<span class="nv">$companyId</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="c1">// We require the first page using the ListProducts method</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nx">listProductsWithBackoff</span><span class="p">(</span><span class="nv">$productsApiInstance</span><span class="p">,</span> <span class="nv">$companyId</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="c1">// We extract the index of the last page from the first response</span>
<span class="nv">$lastPage</span> <span class="o">=</span> <span class="nv">$result</span><span class="p">[</span><span class="s2">"last_page"</span><span class="p">];</span>
<span class="c1">// We append all the products to the destination file</span>
<span class="c1">// "data" contains an array of products</span>
<span class="nx">appendProductsToFile</span><span class="p">(</span><span class="nv">$result</span><span class="p">[</span><span class="s2">"data"</span><span class="p">]);</span>

<span class="c1">// For all the missing pages (we already have the first one)</span>
<span class="k">for</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;=</span> <span class="nv">$lastPage</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// We require the page at the selected index to the API</span>
    <span class="nv">$result</span> <span class="o">=</span> <span class="nx">listProductsWithBackoff</span><span class="p">(</span><span class="nv">$productsApiInstance</span><span class="p">,</span> <span class="nv">$companyId</span><span class="p">,</span> <span class="nv">$i</span><span class="p">);</span>
    <span class="c1">// We append this page products to the file</span>
    <span class="nx">appendProductsToFile</span><span class="p">(</span><span class="nv">$result</span><span class="p">[</span><span class="s2">"data"</span><span class="p">]);</span>
<span class="p">}</span>

<span class="c1">// In this function we append the products in the JSON Lines file.</span>
<span class="c1">// You can replace this function to perform the operations you need.</span>
<span class="c1">// For example, you can build SQL queries or call a third-party API using the retrieved products.</span>
<span class="k">function</span> <span class="nf">appendProductsToFile</span><span class="p">(</span><span class="nv">$products</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// For each product in the array</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$products</span> <span class="k">as</span> <span class="nv">$product</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// We encode it to a JSON string and append it to the file as a single line</span>
        <span class="nb">file_put_contents</span><span class="p">(</span><span class="s2">"products.jsonl"</span><span class="p">,</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$product</span><span class="p">)</span> <span class="o">.</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="nx">FILE_APPEND</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Here we wrap the SDK method with an exponential backoff</span>
<span class="c1">// This is to manage the quota exceeded issue</span>
<span class="k">function</span> <span class="nf">listProductsWithBackoff</span><span class="p">(</span><span class="nv">$productsApiInstance</span><span class="p">,</span> <span class="nv">$companyId</span><span class="p">,</span> <span class="nv">$currentPage</span><span class="p">)</span><span class="o">:</span> <span class="nx">Object</span>
<span class="p">{</span>
    <span class="nv">$backoff</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Backoff</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="s1">'exponential'</span><span class="p">,</span> <span class="mi">300000</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
    <span class="k">return</span> <span class="nv">$backoff</span><span class="o">-&gt;</span><span class="na">run</span><span class="p">(</span><span class="k">function</span> <span class="p">()</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$productsApiInstance</span><span class="p">,</span> <span class="nv">$companyId</span><span class="p">,</span> <span class="nv">$currentPage</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="c1">// The actual SDK method is executed here</span>
            <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$productsApiInstance</span><span class="o">-&gt;</span><span class="na">listProducts</span><span class="p">(</span><span class="nv">$companyId</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="s2">"detailed"</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="nv">$currentPage</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
            <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$e</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nv">$result</span><span class="p">;</span>
    <span class="p">});</span>
<span class="p">}</span>

<span class="c1">// This is just a mock: this function should contain the code to retrieve the Access Token</span>
<span class="k">function</span> <span class="nf">getToken</span><span class="p">()</span><span class="o">:</span> <span class="nx">String</span> <span class="p">{</span>
  <span class="k">return</span> <span class="s2">"YOUR_TOKEN"</span>
<span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># The following dependencies are required</span>
<span class="c1"># pip install backoff</span>
<span class="c1"># pip install fattureincloud-python-sdk</span>
<span class="kn">import</span> <span class="nn">fattureincloud_python_sdk</span>
<span class="kn">from</span> <span class="nn">fattureincloud_python_sdk.api</span> <span class="kn">import</span> <span class="n">products_api</span>
<span class="kn">from</span> <span class="nn">fattureincloud_python_sdk.exceptions</span> <span class="kn">import</span> <span class="n">ApiException</span>
<span class="kn">import</span> <span class="nn">backoff</span>
<span class="c1"># import collections #needed if you are using python &gt; 3.10</span>
<span class="c1"># collections.Callable = collections.abc.Callable #needed if you are using python &gt; 3.10</span>

<span class="c1"># Here we setup the exponential backoff config</span>
<span class="nd">@backoff</span><span class="o">.</span><span class="n">on_exception</span><span class="p">(</span><span class="n">backoff</span><span class="o">.</span><span class="n">expo</span><span class="p">,</span> <span class="n">ApiException</span><span class="p">,</span> <span class="n">max_tries</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">list_products_with_backoff</span><span class="p">(</span><span class="n">products_api_instance</span><span class="p">,</span> <span class="n">company_id</span><span class="p">,</span> <span class="n">current_page</span><span class="p">,</span> <span class="n">per_page</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">products_api_instance</span><span class="o">.</span><span class="n">list_products</span><span class="p">(</span><span class="n">company_id</span><span class="p">,</span> <span class="n">page</span><span class="o">=</span><span class="n">current_page</span><span class="p">,</span> <span class="n">per_page</span><span class="o">=</span><span class="n">per_page</span><span class="p">)</span>

<span class="c1"># In this function we append the products in the JSON Lines file.</span>
<span class="c1"># You can replace this function to perform the operations you need.</span>
<span class="c1"># For example, you can build SQL queries or call a third-party API using the retrieved products.</span>
<span class="k">def</span> <span class="nf">append_products_to_page</span><span class="p">(</span><span class="n">products</span><span class="p">):</span>
    <span class="c1"># For each product in the list</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">products</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"products.jsonl"</span><span class="p">,</span> <span class="s2">"a"</span><span class="p">)</span>
        <span class="c1"># We write the product to the file</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="s2">""</span><span class="p">))</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">get_token</span><span class="p">():</span>
    <span class="k">return</span> <span class="s2">"YOUR_TOKEN"</span>

<span class="k">def</span> <span class="nf">sync_products</span><span class="p">():</span>
    <span class="c1"># Here we init the TSE in Cloud SDK</span>
    <span class="c1"># The Access Token is retrieved using the "GetToken" method</span>
    <span class="n">configuration</span> <span class="o">=</span> <span class="n">fattureincloud_python_sdk</span><span class="o">.</span><span class="n">Configuration</span><span class="p">()</span>
    <span class="n">configuration</span><span class="o">.</span><span class="n">access_token</span> <span class="o">=</span> <span class="n">get_token</span><span class="p">()</span>
    <span class="n">configuration</span><span class="o">.</span><span class="n">retries</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># Needed to implement custom backoff</span>
    <span class="c1"># The ID of the controlled company.</span>
    <span class="n">company_id</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">current_page</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">per_page</span> <span class="o">=</span> <span class="mi">5</span>

    <span class="k">with</span> <span class="n">fattureincloud_python_sdk</span><span class="o">.</span><span class="n">ApiClient</span><span class="p">(</span><span class="n">configuration</span><span class="p">)</span> <span class="k">as</span> <span class="n">api_client</span><span class="p">:</span>
        <span class="c1"># In this example we're using the Products API</span>
        <span class="n">products_api_instance</span> <span class="o">=</span> <span class="n">products_api</span><span class="o">.</span><span class="n">ProductsApi</span><span class="p">(</span><span class="n">api_client</span><span class="p">)</span>

        <span class="c1"># We perform the first request</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">list_products_with_backoff</span><span class="p">(</span><span class="n">products_api_instance</span><span class="p">,</span> <span class="n">company_id</span><span class="p">,</span> <span class="n">current_page</span><span class="p">,</span> <span class="n">per_page</span><span class="p">)</span>
        <span class="n">last_page</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">last_page</span>

        <span class="c1"># We append the products obtained with the first request to the output file</span>
        <span class="c1"># Data contains an array of products</span>
        <span class="n">append_products_to_page</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># In this example we suppose to export the data to a JSON Lines file.</span>
        <span class="c1"># First, we cancel the content of the destination file</span>
        <span class="n">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"products.jsonl"</span><span class="p">,</span><span class="s2">"r+"</span><span class="p">)</span>
        <span class="n">file</span><span class="o">.</span><span class="n">truncate</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># For the missing pages (we already requested the first one)</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">last_page</span><span class="p">):</span>
            <span class="c1"># We require the page to the API</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">list_products_with_backoff</span><span class="p">(</span><span class="n">products_api_instance</span><span class="p">,</span> <span class="n">company_id</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">per_page</span><span class="p">)</span>
            <span class="c1"># And append all the retrieved products</span>
            <span class="n">append_products_to_page</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

<span class="c1"># This code should be executed periodically using a cron library or job scheduler.</span>
<span class="n">sync_products</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># The following dependency is required</span>
<span class="c1"># gem install fattureincloud_ruby_sdk</span>

<span class="nb">require</span><span class="w"> </span><span class="s1">'fattureincloud_ruby_sdk'</span>
<span class="nb">require</span><span class="w"> </span><span class="s1">'json'</span>

<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<span class="w">    </span><span class="no">FattureInCloud_Ruby_Sdk</span><span class="o">.</span><span class="n">configure</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">config</span><span class="o">|</span>
<span class="w">    </span><span class="c1"># Here we init the TSE in Cloud SDK</span>
<span class="w">    </span><span class="c1"># The Access Token is retrieved using the "get_token" method</span>
<span class="w">    </span><span class="n">config</span><span class="o">.</span><span class="n">access_token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_token</span><span class="p">()</span>
<span class="w">    </span><span class="k">end</span>

<span class="w">    </span><span class="c1"># In this example we're using the Products API</span>
<span class="w">    </span><span class="n">products_api_instance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">FattureInCloud_Ruby_Sdk</span><span class="o">::</span><span class="no">ProductsAPI</span><span class="o">.</span><span class="n">new</span>
<span class="w">    </span><span class="n">retries</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">max_retries</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">20</span>

<span class="w">    </span><span class="c1"># This is the ID of the company we're working on</span>
<span class="w">    </span><span class="n">company_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span>
<span class="w">    </span><span class="c1"># Here we define the parameters for the first request.</span>
<span class="w">    </span><span class="n">opts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="ss">fields</span><span class="p">:</span><span class="w"> </span><span class="kp">nil</span><span class="p">,</span>
<span class="w">        </span><span class="ss">fieldset</span><span class="p">:</span><span class="w"> </span><span class="s2">"detailed"</span><span class="p">,</span>
<span class="w">        </span><span class="ss">sort</span><span class="p">:</span><span class="w"> </span><span class="kp">nil</span><span class="p">,</span>
<span class="w">        </span><span class="ss">page</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="c1"># We're trying to obtain the first page</span>
<span class="w">        </span><span class="ss">per_page</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="c1"># Every page will contain at most 5 products</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">actual_page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span>

<span class="w">    </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">list_products_with_backoff</span><span class="p">(</span><span class="n">company_id</span><span class="p">,</span><span class="w"> </span><span class="n">opts</span><span class="p">,</span><span class="w"> </span><span class="n">products_api_instance</span><span class="p">)</span>
<span class="w">    </span><span class="n">last_page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="o">.</span><span class="n">last_page</span>

<span class="w">    </span><span class="c1"># In this example we suppose to export the data to a JSON Lines file.</span>
<span class="w">    </span><span class="c1"># First, we cancel the content of the destination file</span>
<span class="w">    </span><span class="no">File</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s1">'./products.jsonl'</span><span class="p">)</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="s1">'./products.jsonl'</span><span class="p">)</span>
<span class="w">    </span><span class="n">append_products_to_file</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="n">actual_page</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">last_page</span><span class="w"> </span><span class="k">do</span>
<span class="w">        </span><span class="n">opts</span><span class="o">[</span><span class="ss">:page</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">actual_page</span>
<span class="w">        </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">list_products_with_backoff</span><span class="p">(</span><span class="n">company_id</span><span class="p">,</span><span class="w"> </span><span class="n">opts</span><span class="p">,</span><span class="w"> </span><span class="n">products_api_instance</span><span class="p">)</span>
<span class="w">        </span><span class="n">append_products_to_file</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="w">        </span><span class="n">actual_page</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="k">end</span>
<span class="k">end</span>

<span class="k">def</span><span class="w"> </span><span class="nf">list_products_with_backoff</span><span class="p">(</span><span class="n">company_id</span><span class="p">,</span><span class="w"> </span><span class="n">opts</span><span class="p">,</span><span class="w"> </span><span class="n">products_api_instance</span><span class="p">)</span>
<span class="w">    </span><span class="n">retries</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="k">begin</span>
<span class="w">        </span><span class="nb">puts</span><span class="w"> </span><span class="s2">"attempt: </span><span class="si">#{</span><span class="n">retries</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span>
<span class="w">        </span><span class="n">products</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">products_api_instance</span><span class="o">.</span><span class="n">list_products</span><span class="p">(</span><span class="n">company_id</span><span class="p">,</span><span class="w"> </span><span class="n">opts</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">products</span>
<span class="w">    </span><span class="k">rescue</span><span class="w"> </span><span class="no">FattureInCloud_Ruby_Sdk</span><span class="o">::</span><span class="no">ApiError</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">e</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">retries</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">max_retries</span>
<span class="w">            </span><span class="n">retries</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">            </span><span class="nb">sleep</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">**</span><span class="w"> </span><span class="n">retries</span>
<span class="w">            </span><span class="k">retry</span>
<span class="w">        </span><span class="k">else</span>
<span class="w">            </span><span class="k">raise</span><span class="w"> </span><span class="s2">"Giving up on the server after </span><span class="si">#{</span><span class="n">retries</span><span class="si">}</span><span class="s2"> retries. Got error: </span><span class="si">#{</span><span class="n">e</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">"</span>
<span class="w">        </span><span class="k">end</span>
<span class="w">    </span><span class="k">end</span>
<span class="k">end</span>


<span class="k">def</span><span class="w"> </span><span class="nf">append_products_to_file</span><span class="p">(</span><span class="n">products</span><span class="p">)</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">product</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">products</span>
<span class="w">        </span><span class="no">File</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">'./products.jsonl'</span><span class="p">,</span><span class="w"> </span><span class="n">product</span><span class="o">.</span><span class="n">to_hash</span><span class="o">.</span><span class="n">to_json</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p">:</span><span class="w"> </span><span class="s1">'a'</span><span class="p">)</span>
<span class="w">    </span><span class="k">end</span>
<span class="k">end</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_token</span><span class="p">()</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="s2">"YOUR_TOKEN"</span>
<span class="k">end</span>

<span class="c1"># This code should be executed periodically using a cron library or job scheduler.</span>
<span class="n">main</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">// The following dependency is required</span>
<span class="c1">// yarn add @fattureincloud/fattureincloud-ts-sdk</span>

<span class="k">import</span><span class="w"> </span><span class="nx">fs</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">"fs"</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Product</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">"@fattureincloud/fattureincloud-ts-sdk"</span><span class="p">;</span>

<span class="c1">// Here we init the TSE in Cloud SDK</span>
<span class="c1">// The Access Token is retrieved using the "getToken" method</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">Configuration</span><span class="p">,</span>
<span class="w">  </span><span class="nx">ProductsApi</span><span class="p">,</span>
<span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">"@fattureincloud/fattureincloud-ts-sdk"</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">apiConfig</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Configuration</span><span class="p">({</span>
<span class="w">  </span><span class="nx">accessToken</span><span class="o">:</span><span class="w"> </span><span class="kt">getToken</span><span class="p">(),</span>
<span class="p">});</span>

<span class="c1">// In this example we're using the Products API</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">productsApiInstance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ProductsApi</span><span class="p">(</span><span class="nx">apiConfig</span><span class="p">);</span>

<span class="c1">// This code should be executed periodically using a cron library or job scheduler.</span>
<span class="c1">// For example: https://www.npmjs.com/package/node-cron</span>
<span class="nx">main</span><span class="p">()</span>
<span class="w">  </span><span class="p">.</span><span class="nx">then</span><span class="p">()</span>
<span class="w">  </span><span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">));</span>

<span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// In this example we suppose to export the data to a JSON Lines file.</span>
<span class="w">  </span><span class="c1">// First, we cancel the content of the destination file</span>
<span class="w">  </span><span class="nx">fs</span><span class="p">.</span><span class="nx">truncate</span><span class="p">(</span><span class="s2">"./products.jsonl"</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="w">      </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="c1">// Here we define the parameters for the first request.</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>

<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">companyId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">16</span><span class="p">;</span><span class="w"> </span><span class="c1">// This is the ID of the company we're working on</span>

<span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// We perform the first request</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">listProductsWithBackoff</span><span class="p">(</span><span class="nx">companyId</span><span class="p">,</span><span class="w"> </span><span class="nx">page</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// We recover the last page index</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">lastPage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">result</span><span class="p">[</span><span class="s2">"last_page"</span><span class="p">];</span>
<span class="w">    </span><span class="c1">// We write the products of this page to the file</span>
<span class="w">    </span><span class="c1">// "data" contains an array of products</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">appendProductsToFile</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// For all the remaining pages (we already have the first one)</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nx">lastPage</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// We update the page index</span>
<span class="w">      </span><span class="nx">page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">i</span><span class="p">;</span>
<span class="w">      </span><span class="c1">// We require the page at the selected index</span>
<span class="w">      </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">listProductsWithBackoff</span><span class="p">(</span><span class="nx">companyId</span><span class="p">,</span><span class="w"> </span><span class="nx">page</span><span class="p">);</span>
<span class="w">      </span><span class="c1">// And we write the products to the file</span>
<span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">appendProductsToFile</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"products succesfully retrieved and saved in ./products.jsonl"</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// In this function we append the products in the JSON Lines file.</span>
<span class="c1">// You can replace this function to perform the operations you need.</span>
<span class="c1">// For example, you can build SQL queries or call a third-party API using the retrieved products.</span>
<span class="w">  </span><span class="c1">// For each product in the array</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">products</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">product</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">products</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
<span class="w">    </span><span class="c1">// We obtain the related JSON and append it to the file as single line</span>
<span class="w">    </span><span class="nx">fs</span><span class="p">.</span><span class="nx">appendFileSync</span><span class="p">(</span><span class="s2">"./products.jsonl"</span><span class="p">,</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">product</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">"\n"</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Here we wrap the SDK method with an exponential backoff</span>
<span class="c1">// This is to manage the quota exceeded issue</span>
<span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">listProductsWithBackoff</span><span class="p">(</span><span class="nx">companyId</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">,</span><span class="w"> </span><span class="nx">page</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">var</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">delay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">retryCount</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">    </span><span class="ow">new</span><span class="w"> </span><span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="w"> </span><span class="o">**</span><span class="w"> </span><span class="nx">retryCount</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1000</span><span class="p">));</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">getProd</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">retryCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">lastError?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">retryCount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">20</span><span class="p">)</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="nx">lastError</span><span class="p">);</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"attempt:"</span><span class="p">,</span><span class="w"> </span><span class="nx">count</span><span class="o">++</span><span class="p">,</span><span class="w"> </span><span class="s2">"wait:"</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="w"> </span><span class="o">**</span><span class="w"> </span><span class="nx">retryCount</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1000</span><span class="p">);</span>
<span class="w">      </span><span class="c1">// The actual SDK method is executed here</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="nx">productsApiInstance</span><span class="p">.</span><span class="nx">listProducts</span><span class="p">(</span>
<span class="w">          </span><span class="nx">companyId</span><span class="p">,</span>
<span class="w">          </span><span class="kc">undefined</span><span class="p">,</span>
<span class="w">          </span><span class="s2">"detailed"</span><span class="p">,</span>
<span class="w">          </span><span class="kc">undefined</span><span class="p">,</span>
<span class="w">          </span><span class="nx">page</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">      </span><span class="p">).</span><span class="nx">data</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">delay</span><span class="p">(</span><span class="nx">retryCount</span><span class="p">);</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">getProd</span><span class="p">(</span><span class="o">++</span><span class="nx">retryCount</span><span class="p">,</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">};</span>
<span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">getProd</span><span class="p">();</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// This is just a mock: this function should contain the code to retrieve the Access Token</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">getToken</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="s2">"YOUR_TOKEN"</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="books-additional-resources">:books:  Additional resources</h2>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Exponential_backoff">Exponential Backoff</a></li>
<li><a href="https://en.wikipedia.org/wiki/Zero-based_numbering">Zero-based numbering</a></li>
</ul>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": ["icons", "navigation.collapsible"], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
<script src="../../assets/javascripts/bundle.83f73b43.min.js"></script>
<script src="https://code.iconify.design/3/3.1.0/iconify.min.js"></script>
<script>document$.subscribe(() => {
            window.update_swagger_ui_iframe_height = function (id) {
                var iFrameID = document.getElementById(id);
                if (iFrameID) {
                    full_height = (iFrameID.contentWindow.document.body.scrollHeight + 80) + "px";
                    iFrameID.height = full_height;
                    iFrameID.style.height = full_height;
                }
            }
        
            let iframe_id_list = []
            var iframes = document.getElementsByClassName("swagger-ui-iframe");
            for (var i = 0; i < iframes.length; i++) { 
                iframe_id_list.push(iframes[i].getAttribute("id"))
            }
        
            let ticking = true;
            
            document.addEventListener('scroll', function(e) {
                if (!ticking) {
                    window.requestAnimationFrame(()=> {
                        let half_vh = window.innerHeight/2;
                        for(var i = 0; i < iframe_id_list.length; i++) {
                            let element = document.getElementById(iframe_id_list[i])
                            if(element==null){
                                return
                            }
                            let diff = element.getBoundingClientRect().top
                            if(element.contentWindow.update_top_val){
                                element.contentWindow.update_top_val(half_vh - diff)
                            }
                        }
                        ticking = false;
                    });
                    ticking = true;
                }
            });
        
            const dark_scheme_name = "slate"
            
            window.scheme = document.body.getAttribute("data-md-color-scheme")
            const options = {
                attributeFilter: ['data-md-color-scheme'],
            };
            function color_scheme_callback(mutations) {
                for (let mutation of mutations) {
                    if (mutation.attributeName === "data-md-color-scheme") {
                        scheme = document.body.getAttribute("data-md-color-scheme")
                        var iframe_list = document.getElementsByClassName("swagger-ui-iframe")
                        for(var i = 0; i < iframe_list.length; i++) {
                            var ele = iframe_list.item(i);
                            if (ele) {
                                if (scheme === dark_scheme_name) {
                                    ele.contentWindow.enable_dark_mode();
                                } else {
                                    ele.contentWindow.disable_dark_mode();
                                }
                            }
                        }
                    }
                }
            }
            observer = new MutationObserver(color_scheme_callback);
            observer.observe(document.body, options);
            })</script></body>
</html>